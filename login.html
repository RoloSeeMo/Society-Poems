<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Society Poems</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="/Images/Untitled1.png">
</head>
<body data-theme="night" style="visibility: hidden;">
    <div class="form-page-container">
        <div class="form-container">
            <h1>Login or Sign Up</h1>
            <div id="message-container"></div>
            
            <form id="login-form">
                <label for="email">Email:</label>
                <input type="email" id="email" required>
                <label for="password">Password:</label>
                <input type="password" id="password" required>
                <button type="submit" id="loginBtn" class="form-button form-button-primary">Login / Sign Up with Email</button>
            </form>

            <button id="google-signin-btn" class="form-button form-button-secondary">Sign in with Google</button>
            <button id="phone-signin-btn" class="form-button" style="background: #333; color: white;" onclick="window.location.href='cell-login.html'">Sign in with Phone</button>
        </div>
    </div>

    <!-- Firebase SDKs (Compat versions for global access) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // TODO: Replace with your project's actual Firebase configuration.
            const firebaseConfig = {
                apiKey: "AIzaSyDHXEMtVPn46b2qS1CPGUIEuQ8ntLyvLVM",
                authDomain: "society-poems-97f4d.firebaseapp.com",
                databaseURL: "https://society-poems-97f4d-default-rtdb.firebaseio.com",
                projectId: "society-poems-97f4d",
                storageBucket: "society-poems-97f4d.firebasestorage.app",
                messagingSenderId: "723670230106",
                appId: "1:723670230106:web:6d6dda4f8c46626c55a463"
            };

            const app = firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            
            const messageContainer = document.getElementById('message-container');

            function showMessage(type, text) {
                if (!messageContainer) return;
                messageContainer.className = `message-container ${type}-message`;
                messageContainer.textContent = text;
                messageContainer.style.display = 'block';
            }

            // --- Auth Check for Login Page ---
            auth.onAuthStateChanged(user => {
                // If the user is already logged in, redirect them away from the login page.
                if (user) {
                    window.location.href = 'index.html';
                } else {
                    // If no user, make the login form visible.
                    document.body.style.visibility = 'visible';
                }
            });

            // --- Email/Password Login/Signup Logic ---
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    
                    auth.signInWithEmailAndPassword(email, password)
                        .catch(error => {
                            if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-credential') {
                                // If user doesn't exist, create an account.
                                auth.createUserWithEmailAndPassword(email, password)
                                    .catch(createError => {
                                        showMessage('error', `Sign up failed: ${createError.message}`);
                                    });
                            } else {
                                showMessage('error', `Login failed: ${error.message}`);
                            }
                        });
                });
            }

            // --- Google Sign-in Logic ---
            const googleBtn = document.getElementById('google-signin-btn');
            if (googleBtn) {
                googleBtn.addEventListener('click', () => {
                    // Create a new Google provider instance
                    const provider = new firebase.auth.GoogleAuthProvider();
                    
                    // NEW: Set a custom parameter to always prompt for account selection
                    provider.setCustomParameters({
                      'prompt': 'select_account'
                    });

                    // Sign in using the popup method with the configured provider
                    auth.signInWithPopup(provider).catch(error => {
                        showMessage('error', `Google sign-in failed: ${error.message}`);
                    });
                });
            }
        });
    </script>
</body>
</html>
