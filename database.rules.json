{
    "rules": {
      "users": {
        // NEW: Allows any authenticated user to query the /users list.
        // This is required for the "is username taken?" check to work.
        ".read": "auth != null",
        // NEW: Tells Firebase to create an index on the 'username' field.
        // This makes username queries fast and is required by Firebase.
        ".indexOn": "username",
        "$uid": {
          // This rule remains unchanged. It correctly allows a user
          // to write ONLY to their own profile node.
          ".write": "auth != null && auth.uid === $uid"
        }
      },
      "uploads": {
        // These rules remain unchanged.
        ".read": "auth != null",
        ".write": "auth != null",
        ".indexOn": ["uid"]
      },
      "feedback": {
        // This rule remains unchanged.
        ".write": "auth != null"
      }
    }
  }
  