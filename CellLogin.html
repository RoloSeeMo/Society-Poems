<!DOCTYPE html>
<html>
<head>
  <title>Login Page</title>
  <link rel="stylesheet" href="phoneLogin.css">
  <link rel="icon" href="images/Untitled1.png">
  <script type="module" src="firebase-config.js"></script>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <script src="auth_phone_signin.js"></script>
  <script src="ReCaptchaVerifierWidget.js"></script>
  
  <style>
    .loginformcontainer {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center; /* Center vertically */
      margin: auto;
      width: 100%;
      max-width: 400px;
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
    }

    .loginformcontainer h1 {
      text-align: center;
      margin-bottom: 30px;
      color: var(--text-primary);
      font-size: var(--font-size-xx1);
      font-weight: var(--font-weight-bold);
    }

    .error-message {
      color: #dc3545;
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
      padding: 15px;
      border-radius: var(--border-radius-s);
      margin-bottom: 20px;
      display: none;
      font-size: var(--font-size-s);
      text-align: left;
      width: 100%;
      box-sizing: border-box;
    }
    
    .success-message {
      color: #155724;
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
      padding: 15px;
      border-radius: var(--border-radius-s);
      margin-bottom: 20px;
      display: none;
      font-size: var(--font-size-s);
      text-align: left;
      width: 100%;
      box-sizing: border-box;
    }

    .login_form {
      width: 100%;
      max-width: 350px;
      background: var(--bg-secondary, #fff);
      padding: 30px;
      border-radius: var(--border-radius-m);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
    }

    .login_form button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: none;
      border-radius: var(--border-radius-s);
      cursor: pointer;
      font-size: var(--font-size-n);
      font-weight: var(--font-weight-medium);
      transition: all 0.3s ease;
      font-family: "Poppins", sans-serif;
    }
    
    #enterBTN {
      background-color: var(--primary-color);
      color: var(--secondary-color);
    }
    
    #enterBTN:hover:not(:disabled) {
      background-color: var(--primary-color-400);
      transform: translateY(-2px);
    }
    
    /* Removed Google Sign-in button styles as it's no longer in this file */
    
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .login_form label {
      display: block;
      text-align: left;
      margin-bottom: 8px;
      font-weight: var(--font-weight-medium);
      color: var(--text-primary);
      font-size: var(--font-size-n);
    }
    
    .login_form input { /* Adjusted to target all inputs if needed */
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 1px solid var(--border-color, #ccc);
      border-radius: var(--border-radius-s);
      background: var(--bg-secondary, #fff);
      color: var(--text-primary);
      font-size: var(--font-size-n);
      box-sizing: border-box;
      font-family: "Poppins", sans-serif;
    }

    .login_form input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 2px rgba(107, 66, 38, 0.2);
    }

    /* Night theme adjustments for new elements */
    [data-theme="night"] .loginformcontainer h1 {
      color: var(--text-primary);
    }

    [data-theme="night"] .login_form {
      background: var(--bg-secondary);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }

    [data-theme="night"] .error-message {
      background-color: #2d1b1e;
      border-color: #842029;
      color: #ea868f;
    }
    
    [data-theme="night"] .success-message {
      background-color: #0f2419;
      border-color: #0a3622;
      color: #75b798;
    }

    [data-theme="night"] .login_form input {
      background: var(--bg-secondary);
      border-color: var(--border-color);
      color: var(--text-primary);
    }

    [data-theme="night"] .login_form input:focus {
      border-color: var(--primary-color-200);
      box-shadow: 0 0 0 2px rgba(201, 123, 99, 0.2);
    }

    /* Responsive adjustments */
    @media screen and (max-width: 640px) {
      .loginformcontainer {
        padding: 15px;
        width: 100%;
      }
      
      .login_form {
        padding: 20px;
      }
      
      .loginformcontainer h1 {
        font-size: var(--font-size-x1);
      }
    }
  </style>
</head>

<body data-theme="night">
  <div class="loginformcontainer">
    <h1>Login</h1>
    
    <form class="login_form" id="number-form" method="POST" action="?">
      <div id="error-container" class="error-message"></div>
      <div id="success-container" class="success-message"></div>
      <label for="code-input">Phone Number:</label>

      <input style="color: white;" name="code-input" id="code-input" class="code-input border--is-interactive" inputmode="numeric" pattern="[0-9]*" maxlength="12" autocomplete="off" data-lpignore="true" value placeholder="XXX-XXX-XXXX" required>

      <script>
        function getPhoneNumberFromUserInput() {
          const input = document.getElementById('code-input');
            input.addEventListener('input', function (e) {
              // Strip all non-digit characters (including hyphens)
              let digits = e.target.value.replace(/\D/g, '');

              // Limit to 10 digits
              if (digits.length > 10) digits = digits.slice(0, 10);

              // Format as XXX-XXX-XXXX
              let formatted = '';
              if (digits.length > 6) {
                formatted = `${digits.slice(0,3)}-${digits.slice(3,6)}-${digits.slice(6)}`;
              } else if (digits.length > 3) {
                formatted = `${digits.slice(0,3)}-${digits.slice(3)}`;
              } else {
                formatted = digits;
              }

              e.target.value = formatted;
              return e.target.value;
              console.log("Formatted phone number:", formatted);
              });
        }
      </script>

      <button type="button" id="enterBTN" onclick="signInWithPhoneNumber(auth, formatted, appVerifier)">Send One-Time Code</button>
      
      <label for="otp-input" style="display:none;" id="otp-label">Verification Code:</label>
      <input type="text" id="otp-input" style="display:none; color:white;" placeholder="Enter OTP" required>
      <button type="button" id="verifyOTPBtn" onclick="verifyOtp()" style="display:none;">Verify Code</button>

      <button type="button" id="backBTN" onclick='window.location.href= "login.html"'>‚Üê</button>
    </form>
    
  </div>
</body>
</html>